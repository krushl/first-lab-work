# PSR-2: Руководство по стилю кодирования
Устаревший - По состоянию на 2019-08-10 PSR-2 был помечен как устаревший. PSR-12 теперь рекомендуется в качестве альтернативы.

Это руководство расширяет и дополняет PSR-1, базовый стандарт кодирования.

Цель этого руководства состоит в том, чтобы уменьшить когнитивные трудности при сканировании кода от разных авторов. Это делается путем перечисления общего набора правил и ожиданий относительно того, как форматировать PHP-код.

Правила стиля, приведенные здесь, основаны на общих чертах между различными проектами-участниками. Когда различные авторы сотрудничают в нескольких проектах, это помогает иметь один набор руководящих принципов, которые будут использоваться во всех этих проектах. Таким образом, преимущество этого руководства заключается не в самих правилах, а в том, чтобы делиться этими правилами.

Ключевые слова "ДОЛЖЕН", "НЕ ДОЛЖЕН", "ТРЕБУЕТСЯ", "ДОЛЖЕН", "НЕ ДОЛЖЕН", "ДОЛЖЕН", "НЕ ДОЛЖЕН", "РЕКОМЕНДУЕТСЯ", "МОЖЕТ" и "НЕОБЯЗАТЕЛЬНО" в этом документе должны интерпретироваться как описано в RFC 2119.

## 1. Обзор
Код ДОЛЖЕН соответствовать "руководству по стилю кодирования" PSR [PSR-1].

Код ДОЛЖЕН использовать 4 пробела для отступов, а не вкладки.

НЕ ДОЛЖНО БЫТЬ жесткого ограничения на длину строки; мягкий предел ДОЛЖЕН составлять 120 символов; строки ДОЛЖНЫ содержать не более 80 символов.

После объявления пространства имен ДОЛЖНА быть одна пустая строка, а после блока объявлений использования ДОЛЖНА быть одна пустая строка.

Открывающие фигурные скобки для классов ДОЛЖНЫ располагаться в следующей строке, а закрывающие фигурные скобки ДОЛЖНЫ располагаться в следующей строке после тела.

Открывающие фигурные скобки для методов ДОЛЖНЫ быть в следующей строке, а закрывающие фигурные скобки ДОЛЖНЫ быть в следующей строке после тела.

Видимость ДОЛЖНА быть объявлена для всех свойств и методов; абстрактный и окончательный ДОЛЖНЫ быть объявлены до видимости; статический ДОЛЖЕН быть объявлен после видимости.

Ключевые слова структуры управления ДОЛЖНЫ иметь один пробел после них; вызовы методов и функций НЕ ДОЛЖНЫ.

Открывающие фигурные скобки для управляющих структур ДОЛЖНЫ располагаться в той же строке, а закрывающие фигурные скобки ДОЛЖНЫ располагаться в следующей строке после тела.

В открывающих скобках для управляющих структур НЕ ДОЛЖНО быть пробела после них, а в закрывающих скобках для управляющих структур НЕ ДОЛЖНО быть пробела перед ними.

### 1.1. Пример
Этот пример охватывает некоторые из приведенных ниже правил в качестве краткого обзора:

<?php
namespace Vendor\Package;

use FooInterface;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

class Foo extends Bar implements FooInterface
{
    public function sampleMethod($a, $b = null)
    {
        if ($a === $b) {
            bar();
        } elseif ($a > $b) {
            $foo->bar($arg1);
        } else {
            BazClass::bar($arg2, $arg3);
        }
    }

    final public static function bar()
    {
        // method body
    }
}

## 2. Общие положения
### 2.1. Базовый стандарт Кодирования
Код ДОЛЖЕН соответствовать всем правилам, изложенным в PSR-1.

### 2.2. Файлы
Все PHP-файлы ДОЛЖНЫ использовать окончание строки Unix LF (перевод строки).

Все PHP-файлы ДОЛЖНЫ заканчиваться одной пустой строкой.

Закрывающий тег ?> ДОЛЖЕН быть опущен в файлах, содержащих только PHP.

### 2.3. Линии
НЕ ДОЛЖНО быть жесткого ограничения на длину линии.

Мягкое ограничение на длину строки ДОЛЖНО составлять 120 символов; автоматические средства проверки стиля ДОЛЖНЫ предупреждать, но НЕ ДОЛЖНЫ допускать ошибок при мягком ограничении.

Строки НЕ ДОЛЖНЫ быть длиннее 80 символов; строки длиннее этого ДОЛЖНЫ быть разделены на несколько последующих строк не более чем по 80 символов в каждой.

В конце непустых строк НЕ ДОЛЖНО быть завершающих пробелов.

Пустые строки МОГУТ быть добавлены для улучшения читабельности и для обозначения связанных блоков кода.

В строке НЕ ДОЛЖНО быть более одного оператора.

### 2.4. Отступы
Код ДОЛЖЕН использовать отступ в 4 пробела и НЕ ДОЛЖЕН использовать вкладки для отступа.

Примечание: Использование только пробелов, а не смешивание пробелов с вкладками, помогает избежать проблем с различиями, исправлениями, историей и аннотациями. Использование пробелов также облегчает вставку мелкозернистых дополнительных отступов для выравнивания между линиями.

### 2.5. Ключевые слова и значение True/False/Null
Ключевые слова PHP ДОЛЖНЫ быть в нижнем регистре.

Константы PHP true, false и null ДОЛЖНЫ быть в нижнем регистре.

## 3. Пространство имен и объявления об использовании
При наличии после объявления пространства имен ДОЛЖНА быть одна пустая строка.

При наличии все объявления use ДОЛЖНЫ следовать за объявлением пространства имен.

В каждом объявлении ДОЛЖНО быть одно ключевое слово use.

После блока "Использовать" ДОЛЖНА быть одна пустая строка.

Например:

<?php
namespace Vendor\Package;

use FooClass;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

// ... additional PHP code ...

## 4. Классы, свойства и методы
Термин "класс" относится ко всем классам, интерфейсам и признакам.

### 4.1. Расширяет и внедряет
Ключевые слова extends и implements ДОЛЖНЫ быть объявлены в той же строке, что и имя класса.

Открывающая скобка для класса ДОЛЖНА располагаться в отдельной строке; закрывающая скобка для класса ДОЛЖНА располагаться в следующей строке после тела.

<?php
namespace Vendor\Package;

use FooClass;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

class ClassName extends ParentClass implements \ArrayAccess, \Countable
{
    // constants, properties, methods
}


Списки инструментов МОГУТ быть разделены на несколько строк, где каждая последующая строка имеет отступ один раз. При этом первый элемент в списке ДОЛЖЕН находиться в следующей строке, и в каждой строке ДОЛЖЕН быть только один интерфейс.

<?php
namespace Vendor\Package;

use FooClass;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

class ClassName extends ParentClass implements
    \ArrayAccess,
    \Countable,
    \Serializable
{
    // constants, properties, methods
}

### 4.2. Свойства
Видимость ДОЛЖНА быть объявлена для всех свойств.

Ключевое слово var НЕ ДОЛЖНО использоваться для объявления свойства.

В каждом заявлении НЕ ДОЛЖНО быть объявлено более одного свойства.

Имена свойств НЕ ДОЛЖНЫ иметь префикса с одним подчеркиванием для обозначения защищенной или частной видимости.

Объявление свойства выглядит следующим образом.

<?php
namespace Vendor\Package;

class ClassName
{
    public $foo = null;
}

### 4.3. Методы
Видимость ДОЛЖНА быть объявлена для всех методов.

Имена методов НЕ ДОЛЖНЫ иметь префикса с одним подчеркиванием для обозначения защищенной или частной видимости.

Имена методов НЕ ДОЛЖНЫ объявляться с пробелом после имени метода. Открывающая скобка ДОЛЖНА идти по своей собственной строке, а закрывающая скобка ДОЛЖНА идти по следующей строке, следующей за телом. После открывающей скобки НЕ ДОЛЖНО быть пробела, а перед закрывающей скобкой НЕ ДОЛЖНО быть пробела.

Объявление метода выглядит следующим образом. Обратите внимание на размещение круглых скобок, запятых, пробелов и фигурных скобок:

<?php
namespace Vendor\Package;

class ClassName
{
    public function fooBarBaz($arg1, &$arg2, $arg3 = [])
    {
        // method body
    }
}

### 4.4. Аргументы метода
В списке аргументов НЕ ДОЛЖНО быть пробела перед каждой запятой, и после каждой запятой ДОЛЖНО быть по одному пробелу.

Аргументы метода со значениями по умолчанию ДОЛЖНЫ располагаться в конце списка аргументов.

<?php
namespace Vendor\Package;

class ClassName
{
    public function foo($arg1, &$arg2, $arg3 = [])
    {
        // method body
    }
}

Списки аргументов МОГУТ быть разделены на несколько строк, где каждая последующая строка имеет отступ один раз. При этом первый элемент списка ДОЛЖЕН находиться в следующей строке, и в каждой строке ДОЛЖЕН быть только один аргумент.

Когда список аргументов разделен на несколько строк, закрывающая скобка и открывающая скобка ДОЛЖНЫ располагаться вместе в отдельной строке с одним пробелом между ними.

<?php
namespace Vendor\Package;

class ClassName
{
    public function aVeryLongMethodName(
        ClassTypeHint $arg1,
        &$arg2,
        array $arg3 = []
    ) {
        // method body
    }
}

### 4.5. абстрактный, окончательный и статический
При наличии абстрактные и окончательные объявления ДОЛЖНЫ предшествовать объявлению видимости.

При наличии статическое объявление ДОЛЖНО следовать за объявлением видимости.

<?php
namespace Vendor\Package;

abstract class ClassName
{
    protected static $foo;

    abstract protected function zim();

    final public static function bar()
    {
        // method body
    }
}

### 4.6. Вызовы методов и функций
При вызове метода или функции НЕ ДОЛЖНО быть пробела между именем метода или функции и открывающей скобкой, не ДОЛЖНО быть пробела после открывающей скобки и НЕ ДОЛЖНО быть пробела перед закрывающей скобкой. В списке аргументов НЕ ДОЛЖНО быть пробела перед каждой запятой, и после каждой запятой ДОЛЖНО быть по одному пробелу.

<?php
bar();
$foo->bar($arg1);
Foo::bar($arg2, $arg3);
Argument lists MAY be split across multiple lines, where each subsequent line is indented once. When doing so, the first item in the list MUST be on the next line, and there MUST be only one argument per line.

<?php
$foo->bar(
    $longArgument,
    $longerArgument,
    $muchLongerArgument
);

## 5. Структуры управления
Общие правила стиля для структур управления следующие:

После ключевого слова структуры управления ДОЛЖЕН быть один пробел
После открывающей скобки НЕ ДОЛЖНО быть пробела
Перед закрывающей скобкой НЕ ДОЛЖНО быть пробела
Между закрывающей скобкой и открывающей скобкой ДОЛЖЕН быть один пробел
В теле структуры ДОЛЖЕН быть один раз сделан отступ
Закрывающая скобка ДОЛЖНА быть на следующей строке после тела
Корпус каждой конструкции ДОЛЖЕН быть заключен в скобки. Это стандартизирует внешний вид структур и снижает вероятность появления ошибок при добавлении новых линий в тело.

### 5.1. если, в противном случае, в противном случае
Структура if выглядит следующим образом. Обратите внимание на размещение круглых скобок, пробелов и фигурных скобок; и что else и elseif находятся на той же строке, что и закрывающая фигурная скобка из более раннего тела.

<?php
if ($expr1) {
    // if body
} elseif ($expr2) {
    // elseif body
} else {
    // else body;
}

Ключевое слово elseif СЛЕДУЕТ использовать вместо другого, если так, чтобы все ключевые слова управления выглядели как отдельные слова.

### 5.2. switch, case
Конструкция switch выглядит следующим образом. Обратите внимание на круглые скобки, пробелы и фигурные скобки. Выражение case ДОЛЖНО быть смещено на один отступ (четыре пробела) от switch, а ключевое слово break (или иное слово, обозначающее выход из конструкции) ДОЛЖНО располагаться на том же уровне отступов, что и тело case. В том случае, когда в непустом теле case умышленно не используется break, ДОЛЖЕН быть комментарий в стиле // no break.

```php
<?php
switch ($expr) {
    case 0:
        echo 'First case, with a break';
        break;
    case 1:
        echo 'Second case, which falls through';
        // no break
    case 2:
    case 3:
    case 4:
        echo 'Third case, return instead of break';
        return;
    default:
        echo 'Default case';
        break;
}
```

### 5.3. Конструкции while и do while
Конструкция while выглядит следующим образом. Обратите внимание на круглые скобки, пробелы и фигурные скобки.

```php
<?php
while ($expr) {
    // тело конструкции
}
```
Соответственно, конструкция do while выглядит следующим образом. Обратите внимание на круглые скобки, пробелы и фигурные скобки.

```php
<?php
do {
    // тело конструкции
} while ($expr);
```

### 5.4. Конструкция for
Конструкция for выглядит следующим образом. Обратите внимание на круглые скобки, пробелы и фигурные скобки.

```php
<?php
for ($i = 0; $i < 10; $i++) {
    // тело for
}
```

### 5.5. Конструкция foreach
Конструкция foreach выглядит следующим образом. Обратите внимание на круглые скобки, пробелы и фигурные скобки.

```php
<?php
foreach ($iterable as $key => $value) {
    // тело foreach
}
```

### 5.6. Конструкция try catch
Блоки конструкции try catch выглядят следующим образом. Обратите внимание на круглые скобки, пробелы и фигурные скобки.

```php
<?php
try {
    // тело try
} catch (FirstExceptionType $e) {
    // тело catch
} catch (OtherExceptionType $e) {
    // тело catch
}
```

## 6. Замыкания
Замыкания ДОЛЖНЫ описываться с использованием пробела после ключевого слова function и пробелами до и после ключевого слова use.
Открывающая фигурная скобка ДОЛЖНА располагаться на одной строке с именем замыкания строке, а закрывающая фигурная скобка ДОЛЖНА располагаться на следующей строке после тела замыкания.
После открывающей круглой скобки и перед закрывающей круглой скобкой в списке аргументов или переменных НЕ ДОЛЖНО быть пробела.
В списке аргументов или переменных НЕ ДОЛЖНО быть пробелов перед запятыми, но ДОЛЖЕН быть один пробел после каждой запятой.
Аргументы замыкания со значениями по умолчанию ДОЛЖНЫ располагаться в конце списка (после аргументов без значений по умолчанию). {Примечание переводчика: и тут дело не в красоте, нарушение этого правила может привести ко вполне явным ошибкам выполнения программы, когда аргументу без значения по умолчанию «не хватит» значения при вызове.}
Описание замыкания выглядит следующим образом. Обратите внимание на круглые скобки, запятые, пробелы и фигурные скобки.

```php
<?php
$closureWithArgs = function ($arg1, $arg2) {
    // тело
};
 
$closureWithArgsAndVars = function ($arg1, $arg2) use ($var1, $var2) {
    // тело
};
```

Список аргументов и переменных МОЖЕТ быть разделён на несколько строк, каждая из которых дополнена слева одним отступом (четырьмя пробелами). В таком случае первый элемент списка ДОЛЖЕН начинаться с новой строки, и в каждой строке ДОЛЖЕН быть указан только один элемент.

Когда последний список (аргументов или переменных) разделён на несколько строк, закрывающая круглая скобка и открывающая фигурная скобка ДОЛЖНЫ располагаться на одной строке и быть разделены одним пробелом.

Ниже представлены примеры замыканий со списком аргументов и без него, а также со списком переменных, располагающимся на нескольких строках.

```php
<?php
$longArgs_noVars = function (
    $longArgument,
    $longerArgument,
    $muchLongerArgument
) {
   // body
};
 
$noArgs_longVars = function () use (
    $longVar1,
    $longerVar2,
    $muchLongerVar3
) {
   // body
};
 
$longArgs_longVars = function (
    $longArgument,
    $longerArgument,
    $muchLongerArgument
) use (
    $longVar1,
    $longerVar2,
    $muchLongerVar3
) {
   // body
};
 
$longArgs_shortVars = function (
    $longArgument,
    $longerArgument,
    $muchLongerArgument
) use ($var1) {
   // body
};
 
$shortArgs_longVars = function ($arg) use (
    $longVar1,
    $longerVar2,
    $muchLongerVar3
) {
   // body
};
```

Обратите внимание, что правила оформления замыканий также распространяются на случай, когда замыкание используется в качестве аргумента прямо в вызове функции или метода.

```php
<?php
$foo->bar(
    $arg1,
    function ($arg2) use ($var1) {
        // body
    },
    $arg3
);
```

## 7. Заключение
В этом руководстве намеренно не рассмотрены правила и лучшие практики по оформлению многих элементов, список которых включает в себя, но не ограничивается следующим:

Определение глобальных переменных и констант.
Определение функций.
Использование операторов и присваивание.
Межстрочное выравнивание.
Блоки комментариев и документации.
Префиксы и суффиксы в именах классов.
Лучшие практики.
В будущем данные рекомендации МОГУТ быть пересмотрены и расширены, чтобы охватить те или иные элементы кода и практики оформления.